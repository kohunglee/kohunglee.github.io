<meta charset="utf-8">
<script src="./lib.js"></script>
<script src="./mylib.js"></script>
<link rel="stylesheet" href="./style.css">

<div id="jsmind_container" style="width: 100%; height: 100%;">
</div>
<script>


    var mind = {"meta":{"name":"TypeScript Mind Map","author":"Generated by AI","version":"1.0"},"format":"node_tree","data":{"id":"root","topic":"ts","expanded":true,"children":[{"id":"888775d5fdc9e11f","topic":"笔记","expanded":true,"direction":"right","children":[{"id":"init","topic":"初始化","expanded":true,"children":[{"id":"init_advantages","topic":"优点","expanded":true,"children":[{"id":"adv1","topic":"类型错误","expanded":true},{"id":"adv2","topic":"...","expanded":true},{"id":"adv3","topic":"静态类型检查","expanded":true},{"id":"adv4","topic":"代码量多，但好维护","expanded":true}]},{"id":"init_auto_compile","topic":"自动化编译","expanded":true,"children":[{"id":"auto1","topic":"tsc --init","expanded":true,"children":[{"id":"auto1_1","topic":"会搞一个 tsconfig.json 配置文件","expanded":true}]},{"id":"auto2","topic":"tsc --watch index.ts","expanded":true,"children":[{"id":"auto2_1","topic":"这样只要 index.ts 有变化，就会编译","expanded":true}]},{"id":"auto3","topic":"监视变化","expanded":true,"children":[{"id":"auto3_1","topic":"不加具体文件，则全目录监视","expanded":true}]},{"id":"auto4","topic":"配置文件","expanded":true,"children":[{"id":"auto4_1","topic":"配置寻找 \"noEmitOnError\": true,","expanded":true,"children":[{"id":"auto4_1_1","topic":"这样，犯错时不提交","expanded":true}]}]}]},{"id":"init_install","topic":"安装和转化","expanded":true,"children":[{"id":"install1","topic":"sudo npm i typescript -g","expanded":true},{"id":"install2","topic":"tsc index.ts","expanded":true}]}]},{"id":"syntax","topic":"语法","expanded":true,"children":[{"id":"syntax_type_declare","topic":"类型声明","expanded":true,"children":[{"id":"declare1","topic":"let a: string;","expanded":true},{"id":"declare2","topic":"number","expanded":true},{"id":"declare3","topic":"boolean","expanded":true}]},{"id":"syntax_func_declare","topic":"函数变量声明","expanded":true,"children":[{"id":"func_declare1","topic":"function count(x:number, y:number):number{\n// 这样返回值也得是 number\n// 而且调用时的参数也必须是 2 个\n// 多了少了也不行\n}","expanded":true}]},{"id":"syntax_literal","topic":"字面量","expanded":true,"children":[{"id":"literal1","topic":"let a: 'hello'; // 以后只能存 'hello'","expanded":true}]},{"id":"syntax_type_inference","topic":"类型推断","expanded":true,"children":[{"id":"inference1","topic":"它可以推断某个变量的类型（根据我们的赋值）。类型固定后就不能改了。","expanded":true}]},{"id":"syntax_ts_types","topic":"TS 数据类型有","expanded":true,"children":[{"id":"types_js","topic":"js 原有的","expanded":true,"children":[{"id":"js_type1","topic":"string","expanded":true,"children":[{"id":"string1","topic":"let str1: string","expanded":true},{"id":"string2","topic":"let str2:String // S 大写","expanded":true},{"id":"string3","topic":"小写是基元，大写是包装器。\n小写是推荐写法。","expanded":true},{"id":"string4","topic":"小写不可以 a = new String(); 大写可以","expanded":true}]},{"id":"js_type2","topic":"number","expanded":true},{"id":"js_type3","topic":"boolean","expanded":true},{"id":"js_type4","topic":"null","expanded":true},{"id":"js_type5","topic":"undefined","expanded":true},{"id":"js_type6","topic":"bigint","expanded":true},{"id":"js_type7","topic":"symbol","expanded":true},{"id":"js_type8","topic":"object","expanded":true,"children":[{"id":"object1","topic":"小写 object 能储存【非原始类型】，如：\nlet a: object;\nclass Person{}\na = {};\na = {name: 'tom'}\na = [1, 2, 3, 4]\na = function(){}\na = new String('123');\na = new Person();","expanded":true},{"id":"object2","topic":"大写 Object 可以调用到 Object 方法的类型","expanded":true},{"id":"object3","topic":"大写 Object 可以储存一些非 null、undefined 的值","expanded":true}]}]},{"id":"types_ts_new","topic":"ts 新的","expanded":true,"children":[{"id":"ts_type1","topic":"any","expanded":true,"children":[{"id":"any1","topic":"歪理：typescript 慢慢变成 anyscript","expanded":true},{"id":"any2","topic":"放弃 ts 对类型的检查了","expanded":true},{"id":"any3","topic":"这个值存什么类型都行","expanded":true},{"id":"any4","topic":"显式和隐式","expanded":true,"children":[{"id":"any4_1","topic":"let a; // 它也是 any\nlet a: any; // 显式","expanded":true}]},{"id":"any5","topic":"注意点","expanded":true,"children":[{"id":"any5_1","topic":"let c: any;\nc = 9;\nlet x: string;\nx = c // 无报错","expanded":true},{"id":"any5_2","topic":"因此，不要随意 any","expanded":true},{"id":"any5_3","topic":"否则，会破坏其他值。给谁就破坏谁。","expanded":true}]}]},{"id":"ts_type2","topic":"unknown","expanded":true,"children":[{"id":"unknown1","topic":"类型安全的 any","expanded":true},{"id":"unknown2","topic":"与 any 的区别","expanded":true,"children":[{"id":"unknown2_1","topic":"let x: string;\nlet c: unknown;\nx = c // 会报错，即便 c 已经是字符串","expanded":true}]},{"id":"unknown3","topic":"如果 c 已经是字符串，必须加一层判断","expanded":true,"children":[{"id":"unknown3_1","topic":"if(typeof c === 'string'){\n  x = c; // 此时不会报错了\n}","expanded":true}]},{"id":"unknown4","topic":"断言写法","expanded":true,"children":[{"id":"unknown4_1","topic":"x = a as string;","expanded":true}]},{"id":"unknown5","topic":"断言写法2","expanded":true,"children":[{"id":"unknown5_1","topic":"x = <string>a","expanded":true}]},{"id":"unknown6","topic":"与 any 不同，unknown 无法访问未知对象","expanded":true,"children":[{"id":"unknown6_1","topic":"强制断言","expanded":true,"children":[{"id":"unknown6_1_1","topic":"let a: unknown;\na = 'hello';\na.toUpperCase(); // 其实会报错\n(a as string).toUpperCase(); // 无错","expanded":true}]}]}]},{"id":"ts_type3","topic":"never","expanded":true,"children":[{"id":"never1","topic":"作废的类型","expanded":true},{"id":"never2","topic":"作废了，没法用。是函数的。","expanded":true},{"id":"never3","topic":"不能有任何值","expanded":true,"children":[{"id":"never3_1","topic":"可以这样用","expanded":true,"children":[{"id":"never3_1_1","topic":"function throwError():never{\n  throw new Error('程序异常');\n}","expanded":true}]},{"id":"never3_2","topic":"因为这个程序永远不会执行完。如果执行完，则会报错。(函数默认会抛出 undefined)","expanded":true}]},{"id":"never4","topic":"在 if else 里","expanded":true,"children":[{"id":"never4_1","topic":"if(typeof a === 'string'){\n  console.log(a.toUpperCase());\n} else {\n  // 只有 a 为 never 才到此处\n  console.log(a);\n}","expanded":true}]},{"id":"never5","topic":"几乎用不到，一般是我们写错代码，ts 帮我们推断出来，然后赋予的","expanded":true}]},{"id":"ts_type4","topic":"void","expanded":true,"children":[{"id":"void1","topic":"通常用于函数声明 (返回值为空)","expanded":true,"children":[{"id":"void1_1","topic":"function demo():void{\n  return undefined; // 合法\n}","expanded":true},{"id":"void1_2","topic":"// 下面是非法\n// return false;\n// return [];\n// return null;","expanded":true}]},{"id":"void2","topic":"但返回的值，不能当 undefined 使用","expanded":true,"children":[{"id":"void2_1","topic":"如果需要后续操作，可这样：\nfunction demo():undefined {\n}","expanded":true}]},{"id":"void3","topic":"语义上，就是希望开发者不关心该函数的返回值。","expanded":true}]},{"id":"ts_type5","topic":"tuple","expanded":true,"children":[{"id":"tuple1","topic":"元组，它不是关键字，而是一种特殊的数组类型","expanded":true},{"id":"tuple2","topic":"let arr: [string, number];","expanded":true},{"id":"tuple3","topic":"// 就像这样\n// 只能存这种形式的数组","expanded":true},{"id":"tuple4","topic":"let arr: [string, number?];\n// 表示第二位可有可无","expanded":true},{"id":"tuple5","topic":"let arr: [number, ...string[]];\n// 表示可以有无限多的 string 类型的元素","expanded":true}]},{"id":"ts_type6","topic":"enum","expanded":true,"children":[{"id":"enum1","topic":"例子","expanded":true,"children":[{"id":"enum1_1","topic":"enum Direction {\n  Up,\n  Down,\n  Left,\n  Right,\n}","expanded":true}]},{"id":"enum2","topic":"例子2","expanded":true,"children":[{"id":"enum2_1","topic":"function walk(str:Direction) {\n  if(str === Direction.Up) {\n    console.log('UP');\n  }\n}","expanded":true}]},{"id":"enum3","topic":"反向映射","expanded":true},{"id":"enum4","topic":"数字枚举","expanded":true,"children":[{"id":"enum4_1","topic":"// 这样，就是下面的值了\n// Direction[0] // Up\n// Direction.Up // 0","expanded":true},{"id":"enum4_2","topic":"// 自定义索引\nenum Direction {\n  Up = 5, // 5\n  Down = 12, // 12\n  Left, // 13\n  Right, // 14\n}","expanded":true}]},{"id":"enum5","topic":"字符串枚举","expanded":true,"children":[{"id":"enum5_1","topic":"enum Direction {\n  Up = 'up',\n  Down = 'down',\n  Left = 'left',\n  Right = 'right',\n}","expanded":true}]},{"id":"enum6","topic":"推荐使用 const\n叫做内联","expanded":true,"children":[{"id":"enum6_1","topic":"const enum Direction {\n  Up,\n  Down,\n  Left,\n  Right,\n}","expanded":true,"children":[{"id":"enum6_1_1","topic":"内联，可减少编译的 js","expanded":true}]}]}]}]}]},{"id":"syntax_custom_types","topic":"自定义类型方式","expanded":true,"children":[{"id":"custom_type","topic":"type","expanded":true,"children":[{"id":"type1","topic":"比如 shuzi = number","expanded":true},{"id":"type2","topic":"可以创造一个全新的类型，否则 ts 只认识\nnumber 这些","expanded":true},{"id":"type3","topic":"很多公司的规范是，自定义的 type, 首字母大写","expanded":true},{"id":"type4","topic":"用法","expanded":true,"children":[{"id":"type4_1","topic":"type Status = number | string\n// 这两种类型都可以","expanded":true,"children":[{"id":"type4_1_1","topic":"联合类型","expanded":true}]},{"id":"type4_2","topic":"type Gender = '男' | '女'\n// 只能使用这两个字符串","expanded":true},{"id":"type4_3","topic":"type Area = {}, type Address = {};\ntype House = Area & Address;\n// 这样，House 就必须包含 Area 和 Address 都有的内容。","expanded":true,"children":[{"id":"type4_3_1","topic":"交叉类型","expanded":true}]}]}]},{"id":"custom_interface","topic":"interface","expanded":true,"children":[{"id":"interface_intro","topic":"专门为对象服务\ntype 更宽","expanded":true},{"id":"interface_readability","topic":"可读性","expanded":true,"children":[{"id":"readability1","topic":"type 和 interface 功能上有部分重合","expanded":true}]},{"id":"interface_declare_obj","topic":"声明对象","expanded":true,"children":[{"id":"obj1","topic":"可选属性","expanded":true,"children":[{"id":"obj1_1","topic":"let person: {\n  name: string,\n  age?: number\n} // 有没有 age 都可","expanded":true}]},{"id":"obj2","topic":"属性分割","expanded":true,"children":[{"id":"obj2_1","topic":"逗号","expanded":true,"children":[{"id":"obj2_1_1","topic":"let a = {b:number, c:number}","expanded":true}]},{"id":"obj2_2","topic":"换行","expanded":true,"children":[{"id":"obj2_2_1","topic":"let a = {\n  b:string\n  c:string\n}","expanded":true}]}]},{"id":"obj3","topic":"索引签名","expanded":true,"children":[{"id":"obj3_1","topic":"let person: {\n  name: string,\n  age: string,\n  [key:string]:any\n}\n// 这样就能随意加了","expanded":true}]}]},{"id":"interface_declare_func","topic":"声明函数","expanded":true,"children":[{"id":"func1","topic":"let count: (a:number, b:number) => number;\n// ↑ 只能装这种函数\n// => 表示函数类型","expanded":true},{"id":"func2","topic":"count = function(a:number, b:number):number{\n  return a + b;\n}","expanded":true},{"id":"func3","topic":"// 也可以简写\ncount = function(a, b){\n  return a + b\n}","expanded":true}]},{"id":"interface_declare_array","topic":"数组类型","expanded":true,"children":[{"id":"array1","topic":"let arr: string[];\n// 只能存字符串数组","expanded":true},{"id":"array2","topic":"let arr2: Array<number>\n// 只能写数值数组\n// 泛型","expanded":true}]}]}]}]}]}]}};


mind002 = {
    /* 元数据，定义思维导图的名称、作者、版本等信息 */
    "meta":{
        "name":"jsMind-demo-tree",
        "author":"hizzgdev@163.com",
        "version":"0.2"
    },
    /* 数据格式声明 */
    "format":"node_tree",
    /* 数据内容 */
    "data":{"id":"root","topic":"jsMind","children":[
        {"id":"easy","topic":"Easy","direction":"left","expanded":false,"children":[
            {"id":"easy1","topic":"Easy to show"},
            {"id":"easy2","topic":"Easy to edit"},
            {"id":"easy3","topic":"Easy to store"},
            {"id":"easy4","topic":"Easy to embed"}
        ]},
        {"id":"open","topic":"Open Source","direction":"right","expanded":true,"children":[
            {"id":"open1","topic":"on GitHub"},
            {"id":"open2","topic":"BSD License"}
        ]},
        {"id":"powerful","topic":"Powerful","direction":"right","children":[
            {"id":"powerful1","topic":"Base on Javascript"},
            {"id":"powerful2","topic":"Base on HTML5"},
            {"id":"powerful3","topic":"Depends on you"}
        ]},
        {"id":"other","topic":"test node","direction":"left","children":[
            {"id":"other1","topic":"I'm from local variable"},
            {"id":"other2","topic":"I can do everything"}
        ]}
    ]}
};

    mind = mind002;
    var testmark = mylib.toMarkdown(mind);
    mind = mylib.toObj(testmark);

    var options = {  // 配置
       container : 'jsmind_container',         // [必选] 容器的ID
       editable : true,       // 是否启用编辑
       theme :'primary',           // 主题
       mode :'side',           // 布局模式
       support_html : false,    // 是否支持节点里的HTML元素
       log_level: 'disable',      // 日志级别
       view:{
           engine: 'svg',   // 思维导图各节点之间线条的绘制引擎
           hmargin:100,        // 思维导图距容器外框的最小水平距离
           vmargin:50,         // 思维导图距容器外框的最小垂直距离
           line_width:2,       // 思维导图线条的粗细
           line_color:'#555',  // 思维导图线条的颜色
           line_style:'curved',// 思维导图线条的样式，直线(straight)或者曲线(curved)
           custom_line_render: null,  // 自定义的线条渲染方法
           draggable: true,   // 当容器不能完全容纳思维导图时，是否允许拖动画布代替鼠标滚动
           hide_scrollbars_when_draggable: false, // 当设置 draggable = true 时，是否隐藏滚动条
           node_overflow: 'wrap', // 节点文本过长时的样式
           zoom: {             // 配置缩放
               min: 0.5,       // 最小的缩放比例
               max: 2.1,       // 最大的缩放比例
               step: 0.1,      // 缩放比例间隔
           },
           custom_node_render: null, // 自定义的节点渲染方法
       },
       layout:{
           hspace:30,          // 节点之间的水平间距
           vspace:20,          // 节点之间的垂直间距
           pspace:13,          // 节点与连接线之间的水平间距（用于容纳节点收缩/展开控制器）
           cousin_space:0      // 相邻节点的子节点之间的额外的垂直间距
       },
       shortcut:{
           enable:true,        // 是否启用快捷键
           handles:{},         // 命名的快捷键事件处理器
           mapping:{           // 快捷键映射
               addchild   : 9, 	// <Insert>, <Ctrl> + <Enter>
               addbrother : 13,    // <Enter>
               editnode   : 113,   // <F2>
               delnode    : 46,    // <Delete>
               toggle     : 32,    // <Space>
               left       : 37,    // <Left>
               up         : 38,    // <Up>
               right      : 39,    // <Right>
               down       : 40,    // <Down>
           }
       },
    };
    var jm = new jsMind(options);
    jm.show(mind);
</script>

<div class="mypanel">
    <li><button class="sub" onclick="save_file();">保存文件</button></li>
    <li><br><br><input id="file_input" class="file_input" type="file" /></li>
    <li><button class="sub" onclick="open_file();">打开文件</button></li>
    <li><br><br>有 <span id="chineseCount">x</span> 个汉字</li>
</div>

<script>
// 保存文件
function save_file() {
    var mind_data = jm.get_data();
    var mind_name = mind_data.meta.name;
    mind_data = mylib.toMarkdown(mind_data);  // 转化为 markdown 格式
    var mind_str = jsMind.util.json.json2string(mind_data);
    jsMind.util.file.save(mind_str, 'text/jsmind', mind_name + '.jm');
}

// 读取文件
function open_file() {
    var file_input = document.getElementById('file_input');
    var files = file_input.files;
    if (files.length > 0) {
        var file_data = files[0];
        jsMind.util.file.read(file_data, function (jsmind_data, jsmind_name) {
            var mind = jsMind.util.json.string2json(jsmind_data);
            if (jsmind_data.startsWith('"#')) {  // 简单判断一下是否是 markdown 格式，若是，转化一下
                mind = mylib.toObj(mind);
            }
            if (!!mind) {
                jm.show(mind);
            } else {
                prompt_info('can not open this file as mindmap');
            }
        });
    } else {
        prompt_info('please choose a file first');
    }
}

// 定时统计汉字数量
setInterval(function(){
    var mindDataStr = JSON.stringify(jm.get_data());
    var chineseCount = mylib.countChineseCharacters(mindDataStr);
    document.getElementById('chineseCount').innerText = chineseCount;
}, 1000);
</script>