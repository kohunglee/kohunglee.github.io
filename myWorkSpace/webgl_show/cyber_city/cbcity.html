<!DOCTYPE html>
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta http-equiv="pragma" content="no-cache">
<style>
    body{margin: 0;}
    #someCtrl {
        position: fixed;
        top: 10px;
        opacity: 0.5;
        left: 10px;
    }
    #someCtrl button {
        width: 45px;
        height: 30px;
    }
    .info-modal {
        position: fixed;
        background-color: #e4e4e4f5;
        left: 30px;
        top: 30px;
        width: 500px;
        height: 80vh;
        z-index: 1;
        overflow: auto;
        padding: 1em;
    }
</style>
<canvas id=c style="width:99vw;height:99vh"></canvas>
<script src="./cannon29kb.js"></script>
<img src='./texture.jpeg' id=marble hidden>
<script src="./openworld.js"></script>
<script src="./index.js" type="module"></script>
<div id="someCtrl">
    <button id="btn01" style="width: 105px;">程序说明</button>
    <button id="btn02" style="width: 105px;">加载示例存档</button>
    <button id="btn03" style="width: 105px;">到城寨入口</button>
    <button id="btn04" style="width: 105px;">到坐标原点</button>
</div>
<div class="info-modal" id="myinfoModal" hidden>
    <div>

    <button id="closeBtn">关闭</button>
    <hr>

    <h1>《赛博城寨》 三维空间笔记系统</h1>

    <p>大家好，欢迎体验《赛博城寨》。这是一个基于 WebGL 技术开发的概念性程序，旨在探索三维空间中记录文字的可能性。它非常轻巧，体积仅有约 40KB 左右。</p>
    <p>
        在这个开放世界里，我们通过伪随机数生成了一万个大小各异的立方体。您可以靠近任何一个方块，用鼠标左键选中它的某个表面，然后输入您想要展示的字句。同时，您也可以随时读取或保存您的创作存档。
    </p>
    <p><b><a id="textInfoId" href="javascript:void(0)">单击此处加载示例存档</a>，立即开始探索这个独特的开放世界吧！</b></p>
    
    <hr>

    <h2>基本操作指南</h2>
    <ul>
        <li><b>W / A / S / D</b>：控制角色前后左右移动。</li>
        <li><b>空格 或 E</b>：跳跃，连续点按为飞翔（推荐使用 <b>E</b> 键）。</li>
        <li><b>Q 或 Shift</b>：按住以逐渐加速行走（推荐使用 <b>Q</b> 键）。</li>
        <li><b>F</b>：冻结视角，让您悬停在空中，以便细致观察。</li>
        <li><b>I</b>：瞬间将您传送至 150 米的高空，俯瞰全景。</li>
    </ul>

    <hr>

    <h2>详细功能介绍</h2>

    <h3>编辑模式</h3>
    <p>当您靠近一个方块的表面时，单击鼠标左键可进入第一人称锁定视角。当屏幕中心的圆点周围出现色环后，再次单击左键即可进入编辑模式。</p>
    <ol>
        <li>
            <b>文本偏移</b>：编辑界面的第一行是偏移量调整。由于许多方块的边缘可能被其他物体遮挡，您可以通过设置 0 到 1 之间的数值来调整文本位置。例如，输入 0.5 即可将文本偏移半个方块的距离。
        </li>
        <li>
            <b>文本输入框</b>：在此处输入您的笔记内容。我们支持简单的颜色标记：
            <ul>
                <li><code>#</code> + 空格：后续文字变为蓝色。</li>
                <li><code>%</code> + 空格：后续文字变为红色。</li>
                <li><code>@</code> + 空格：后续文字恢复为默认的白色。</li>
            </ul>
        </li>
        <li>
            <b>辅助工具栏</b>：这里有一系列按钮，其中一个名为<b>【数字行号辅】</b>的功能可能稍显特别。它的作用是帮助您估算当前方块表面大致可以容纳多少行文字，这在判断一些难以触及的方块顶部空间时尤其有用。
        </li>
        <li>
            <b>数据恢复</b>：第四块是<b>【从浏览器中恢复】</b>功能。您的每一次操作都会实时备份到浏览器的 localStorage 中，以防意外丢失。
        </li>
    </ol>
    
    <h3>仪表盘解读 (左下角)</h3>
    <ul>
        <li><b>FPS / 渲染</b>：分别代表实时帧率和渲染每帧所需的毫秒数。此数值因设备配置而异。</li>
        <li><b>速度 / 位置</b>：大致估算您当前移动的速度，以及在三维世界中的精确坐标。</li>
        <li><b>当前模型数</b>：此为开发调试信息。<b>闪电</b>代表理论上视野内的模型数；<b>can</b> 为被赋予物理属性的物体数；<b>w</b> 是实际渲染的模型数；其后数字是已从存档载入的模型数。<b>纹理</b>则显示当前已绘制的纹理数量。</li>
        <li><b>区域坐标</b>：例如<b>【东1南1】</b>，这是一个方便您定位的坐标系统。以世界中心 (0,0,0) 为原点，向东 100 米、再向南 100 米的区域即为【东1南1】。整个城寨被划分为 100 个这样的方格区域。</li>
    </ul>

    <h3>城市命名与区块划分</h3>
    <p>
        您会注意到，屏幕顶端会显示如<b>【福建漳州】</b>、<b>【广东深圳】</b>之类的城市名称。我们选取了中国 GDP 排名靠前的 100 个城市，并根据它们的地理方位，为城寨中的 100 个区块进行了命名，让每个板块都拥有一个独特的名字。
    </p>
    <p>详细的城市分布如下，以便于您记忆和定位：</p>
    <ol>
         <li>乌鲁木齐 鄂尔多斯 包头 呼和浩特 北京 廊坊 唐山 沈阳 长春 哈尔滨</li>
        <li>榆林 太原 石家庄 保定 沧州 天津 东营 烟台 大连 威海</li>
        <li>兰州 新乡 邯郸 德州 济宁 济南 泰安 淄博 潍坊 青岛</li>
        <li>西安 洛阳 郑州 周口 菏泽 徐州 宿迁 临沂 淮安 连云港</li>
        <li>襄阳 南阳 阜阳 滁州 南京 扬州 镇江 泰州 盐城 南通</li>
        <li>绵阳 宜昌 合肥 芜湖 常州 湖州 无锡 苏州 嘉兴 上海</li>
        <li>成都 重庆 常德 岳阳 武汉 九江 金华 杭州 绍兴 宁波</li>
        <li>宜宾 遵义 衡阳 长沙 株洲 宜春 南昌 上饶 温州 台州</li>
        <li>昆明 曲靖 贵阳 广州 赣州 漳州 厦门 泉州 福州 宁德</li>
        <li>南宁 湛江 茂名 江门 佛山 中山 珠海 东莞 深圳 惠州</li>
    </ol>

    <hr>
    
    <h2>开发初衷</h2>
    <dl>
        <dt><b>一次笔记维度的探索</b></dt>
        <dd>
            我们习惯了各种形式的笔记工具：一维的如 TXT、Word；二维的如 Xmind 思维导图、无边白板。那么，笔记能否以三维形式呈现呢？我们认为答案是肯定的，毕竟人脑本身就更擅长理解和记忆空间信息。为了让这个概念程序尽可能小巧，我们用伪随机数生成了一万个方块供您记录，这或许足够您书写一生了。
        </dd>
        <br>
        <dt><b>一次原生 WebGL 的实践</b></dt>
        <dd>
            这也是一个个人技术练习项目。为了追求极致的体积和性能，程序并未使用 Three.js 等现成框架，而是直接基于原生 WebGL 进行开发。
        </dd>
    </dl>
    
    <h2>如何获取本程序？</h2>
    <p>理论上，您只需在浏览器中按下 <code>Ctrl + S</code> 即可保存网页。但请注意，由于程序采用了模块化开发，必须在 HTTP 环境下（例如通过本地服务器）才能正常启动。</p>
    
    <h2>关于框架</h2>
    <p>
        本程序基于自研的 <code>openworld.js</code> 框架构建。如果您对此感兴趣，欢迎访问我们的 GitHub 仓库：<a href="https://github.com/kohunglee/openworld-js" target="_blank">https://github.com/kohunglee/openworld-js</a>，希望能送给我们一个 Star 以示鼓励，感激不尽！
    </p>
    <p>
        <code>openworld.js</code> 的未来目标是致力于简化三维开放世界的开发流程，以极小的体积实现高质量的在线虚拟展览馆、在线三维漫游、三维重建和建筑设计等应用。（<a href="//www.ccgxk.com" target="_blank">www.ccgxk.com</a>）
    </p>

    <hr>

    <button id="closeBtn02">关闭</button>

    </div>
    
</div>
<script>

// 程序说明
btn01.addEventListener('mousedown', function(event) {
    document.getElementById('myinfoModal').hidden = false;
});

// 城寨入口
btn03.addEventListener('mousedown', function(event) {
    k.mainVPlayer.body.position.x = 113;
    k.mainVPlayer.body.position.y = 5;
    k.mainVPlayer.body.position.z = 495;
});

// 坐标原点
btn04.addEventListener('mousedown', function(event) {
    k.mainVPlayer.body.position.x = 7.6;
    k.mainVPlayer.body.position.y = 5;
    k.mainVPlayer.body.position.z = 16.5;
});

// 关闭 【程序说明】模态框
document.getElementById('closeBtn').addEventListener('click', function() {
    document.getElementById('myinfoModal').hidden = true;
});

// 关闭 【程序说明】模态框 02 
document.getElementById('closeBtn02').addEventListener('click', function() {
    document.getElementById('myinfoModal').hidden = true;
});
</script>